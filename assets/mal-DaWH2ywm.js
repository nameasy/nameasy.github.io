import"./projects-CWkPN6bc.js";import"./related-CQ4a21Pc.js";const w=(e,t)=>{let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>{e.apply(void 0,s)},t)}},p={WATCHLIST:"watchlist",STATS:"stats"},m="view",g=250;let o=document.querySelector("body"),i,c,u,h=new URLSearchParams(window.location.search);const d=(e,t)=>{for(const n of t){const s=n.id===e;n.hidden=!s;const r=i.querySelector(`[value="${n.id}"]`);r&&(r.checked=s)}},y=e=>{h.set(m,e);const t=`${window.location.pathname}?${h.toString()}${window.location.hash}`;history.replaceState(null,null,t)},S=()=>{const e=window.location.hash;if(e){const t=document.querySelector(e);t&&t.scrollIntoView()}},b=e=>{const t=e.target.value;t&&(d(t,c),y(t))},E=()=>{o&&(i=o.querySelector(".section__filter"),c=o.querySelectorAll(".section__item"),u=h.get(m)||p.WATCHLIST,d(u,c),S(),i.addEventListener("change",w(b,g)))},T=Vue.createApp({data(){return{anime:[],histogram:{},columns:[],uniqueYears:[],max:0}},async mounted(){try{const s=await fetch("./data/anime.json");if(!s.ok)throw new Error("Не удалось получить данные");const r=await s.json();this.anime=r,this.initializeData(),this.calculateHistogram(),this.createChart()}catch(s){console.error(s)}const e=()=>{const s=this.$refs.stats.querySelectorAll(".chart__month");let r=0;s.forEach(f=>{const l=f.offsetWidth;l>r&&(r=l)}),this.$refs.stats.style.setProperty("--width",`${r}px`)},t=new MutationObserver(s=>{for(let r of s)if(r.attributeName==="hidden"){e();break}}),n=this.$refs.stats;t.observe(n,{attributes:!0}),this.$nextTick(()=>{e(),window.addEventListener("resize",e)})},beforeUnmount(){window.removeEventListener("resize",this.updateWidth)},methods:{initializeData(){const e=this.anime.map(t=>t.date.substring(0,4));this.uniqueYears=[...new Set(e)].sort((t,n)=>n-t)},calculateHistogram(){this.anime.forEach(e=>{const t=e.date.substring(0,7);this.histogram[t]=(this.histogram[t]||0)+1}),this.max=Math.max(...Object.values(this.histogram))},createChart(){for(const e of this.uniqueYears)for(let t=1;t<=12;t++){const n=`${e}-${t.toString().padStart(2,"0")}`,s=this.histogram[n]||0;if(s!==0){const r=s/this.max*100,a=this.getMonthName(t);this.columns.push({year:e,month:t,value:s,percentage:r,date:a})}}},getMonthName(e){return["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][e-1]},filterTitlesByYearMonth(e,t){const n=this.anime.filter(s=>{const r=parseInt(s.date.substring(0,4)),a=parseInt(s.date.substring(5,7));return r===parseInt(e)&&a===t});return n.length===0?[]:n},hasTitles(e,t){return this.filterTitlesByYearMonth(e,t).length>0},filterColumnsByYear(e){return this.columns.filter(t=>t.year===e)}}});T.mount(".page");E();
